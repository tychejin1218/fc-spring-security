# Spring Security 권한 부여 및 접근 제한

## GrantedAuthority

- **GrantedAuthority**를 활용하여 권한 부여 기능을 적용할 수 있음.
    - 사용자마다 서로 다른 권한을 가지며, 권한에 따라 특정 작업만 수행 가능.
    - 사용자, 권한, 기능은 서로 연결되어 있음.
    - **GrantedAuthority**뿐만 아니라 **UserDetails**도 함께 연결되어야 함.
- 사용자는 하나 이상의 권한을 가질 수 있음.
- **UserDetailsService**는 사용자 정보를 제공함.
- 인증된 사용자(**UserDetails**)는 하나 이상의 **GrantedAuthority**를 가질 수 있음.

---

## 권한 부여 규칙의 예시

- **A** : 엑셀 업로드 기능 사용 가능.
- **B** : 구매 후기 데이터 삭제 가능.
- **C** : 주문 데이터를 조회만 가능하고, 삭제는 불가.

**GrantedAuthority**를 활용하면 위와 같은 기능을 제공할 수 있음.

---

## 엔드포인트 접근 제한

- 사용자마다 특정 엔드포인트 접근을 제한할 수 있음.
- 대부분의 경우, 인증된 사용자라면 모든 엔드포인트를 호출할 수 있도록 설정이 가능함.
- 예시:  
  조회, 추가, 삭제, 수정 엔드포인트 총 4개가 존재할 때:
    - **A** : 조회만 가능.
    - **B** : 조회, 추가, 삭제, 수정 모두 가능.

---

## 스프링 시큐리티 제공 주요 메서드

Spring Security에서 아래 메서드들을 활용하여 권한과 엔드포인트 접근을 제어할 수 있음:

1. **`hasAuthority()`**

- 제한을 구성하는 하나의 권한을 파라미터로 전달받아, 해당 권한이 있는 사용자가 엔드포인트에 접근할 수 있도록 허용.

2. **`hasAnyAuthority()`**

- 하나 이상의 권한을 파라미터로 전달받으며, 주어진 권한 중 하나라도 있을 경우 엔드포인트 접근을 허용.

3. **`access()`**

- Spring Security **5 버전**까지 유효한 메서드.
- **SpEL(Spring Expression Language)**을 사용하여 권한 부여 규칙을 정의할 수 있음.
- 높은 자율성을 제공하지만, 가독성이 떨어지고 디버깅이 어려운 단점이 있음.

---

## Spring Security 6 이후

- Spring Security 6 버전 이후에는 **Custom AuthorizationManager**를 생성하여 활용 가능.
- 이를 통해 더 세부적이고 유연한 권한 부여 정책을 구현할 수 있음.
