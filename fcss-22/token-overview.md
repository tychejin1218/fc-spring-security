# 토큰에 대해서

## 토큰이란?

토큰은 **특정 엔드포인트에 접근하려는 클라이언트가 HTTP 헤더를 통해 전달하는 문자열**입니다.

- 단순한 형태의 문자열일 수도 있고,  
  예: UUID 같은 단순 문자열
- **JWT (JSON Web Token)** 처럼 복잡한 형식일 수도 있습니다.

### 토큰의 비유
토큰은 **호텔 출입문 카드**와 비슷하게 설명할 수 있습니다:
- 호텔 방에 모든 사람이 접근할 수 없습니다.
- 호텔 방을 예약한 사람만 접근 권한이 있으며, **체크인** 과정을 통해 특정 방에 접근할 수 있는 출입문 카드를 받습니다.
- 이 카드로 특정 방에만 접근할 수 있습니다.
- 출입문 카드가 있더라도 **모든 방에 접근할 수 있는 것은 아닙니다.**

---

## 토큰을 이용하는 시나리오

### UUID 기반의 토큰 활용 시나리오
#### 과정 요약
1. 사용자가 **ID/PW로 인증 시도**  
   엔드포인트: `/login`
2. 인증 성공 시, 사용자를 위한 **토큰 생성**  
   예시: `021abc02321`
3. 서버에서 생성한 토큰을 **데이터베이스에 저장**
4. 생성한 토큰을 **사용자에게 반환**
   예시: `021abc02321`
5. 사용자가 다른 엔드포인트 호출 시 토큰과 함께 요청  
   예시 엔드포인트: `/accounts`  
   요청 헤더: `token: 021abc02321`
6. 서버가 토큰을 **검증**
7. 토큰이 유효할 경우 **결과값 반환**

---

## 토큰을 사용하는 장점

### **장점 1. 요청할 때마다 자격 증명 공유 불필요**
- 기존 방식 예: **HTTP Basic 인증**
  - 매번 ID/PW를 입력해야 하므로 불편함과 보안 문제가 있음.
  - 프론트엔드에서 매번 ID/PW 요청은 비효율적이며 보안 리스크가 있음 (가로챌 가능성 증가).
- **토큰 기반 인증**은 인증을 위해 최초 한 번만 ID/PW를 요청하면 됩니다.
  - 이후부터는 **자격 증명 대신 토큰**을 사용.
  - 가로채더라도 토큰에서 자격 증명을 알 수 없어 보안성이 높아집니다.

---

### **장점 2. 토큰의 수명을 짧게 지정 가능**
- 토큰에는 **생명 주기(Life Cycle)**가 있으며, 만료 기한을 설정할 수 있습니다.
- 만약 토큰이 해커 등에 의해 탈취되더라도:
  1. 토큰이 만료되면 사용할 수 없게 됩니다.
  2. 탈취 상황 판단 시, 해당 토큰을 즉시 **폐기**할 수 있습니다.
  > 예시: 탈취된 토큰이 무효화되므로 추가 피해를 막을 수 있음.

---

### **장점 3. 자격 증명을 무효화하지 않고 토큰만 무효화 가능**
- 만약 **ID/PW가 탈취**된다면, 사용자는 자격 증명을 **더 이상 사용할 수 없습니다**.
  - 새로운 ID/PW를 만들어야 하는 부담이 있습니다.
- 반면 **토큰 기반 인증**이라면,
  - **탈취된 토큰만 폐기**하고 새로운 토큰을 쉽게 생성할 수 있습니다.

---

### **장점 4. 토큰에 사용자 권한과 같은 세부 정보 저장 가능**
- 저장 가능 데이터:
  - 사용자 권한(Levels), 사용자 ID, 기타 추가 정보
- 이를 통해 인증뿐만 아니라 **권한 관리 기능**까지 확장할 수 있습니다.
- 다만, 저장 데이터는 간결한 정보로 유지하는 것이 좋습니다.

---

### **장점 5. 인증 책임을 시스템의 다른 구성 요소에 위임 가능**
- 토큰으로 **사용자 정보를 직접 관리하지 않고도 인증 수행**이 가능합니다.
- 예를 들어, 카카오/네이버 등 **외부 플랫폼 계정**으로 인증을 위임할 수 있습니다.
- 이를 통해 **인증 책임의 분리**가 가능합니다.

---

## JWT (JSON Web Token)

### **JWT란?**
JWT는 **JSON Web Token**의 약자로, 많이 사용되는 토큰 형태 중 하나입니다.

특징:
- **OAuth 2.0**에서도 다루기 때문에 익숙해질 필요가 있습니다.
- 이름의 구성:
  - **JSON:** 데이터 형식이 JSON 기반
  - **Web:** 웹 요청에 적합하게 설계
  - **Token:** 토큰 구현체

---

### **JWT의 구성 요소**
JWT는 일반적인 문자열(UUID)과 달리 **마침표(.)로 구분된 세 부분**으로 구성됩니다:
1. **헤더 (Header)**
2. **본문 (Payload)**
3. **디지털 서명 (Signature)**

---

### **1. 헤더와 본문**
- **형식:** JSON 형식으로 지정되고 Base64로 인코딩됩니다.
- **헤더:** 토큰 메타 데이터를 저장합니다.
  - 서명 생성에 사용된 알고리즘 정보 등을 포함.
- **본문 (Payload):** 권한 부여에 필요한 데이터를 저장합니다.
  - 예: 일련번호, 사용자 이름, 시간 등.
- 데이터 저장 시 유의점:
  - **가볍고 간결**하게 유지해야 합니다.
  - 긴 본문 데이터는 요청 속도 감소 및 암호화 서명 처리 시간 증가를 유발할 수 있습니다.

---

### **2. 디지털 서명**
- 디지털 서명은 **JWT의 신뢰성을 보장**합니다.
- 만약 생략된다면:
  - 네트워크 전송 중 **토큰 발송자를 확인**할 수 없습니다.
  - 토큰 변경 여부를 알 수 없어 보안 문제가 발생합니다.
- **토큰을 안전하게 보호**하기 위해 서명은 필수적입니다.
